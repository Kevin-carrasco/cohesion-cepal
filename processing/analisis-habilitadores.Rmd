---
title: "analisis-habilitadores"
author: "Equipo CEPAL-ELSOC"
date: "15-09-2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
```


Este código produce los análisis necesarios para el capítulo III del informe CEPAL-COES.

```{r include=FALSE}
# Cargar paquetes
pacman::p_load(dplyr, car, knitr, kableExtra, ggplot2, sjPlot, sjmisc)
```

```{r}
# Cargar base de datos
load("input/data/proc/data_clases.RData")
```

```{r}
table(data$lclass)
```

# Elementos habilitadores
- Inclusión laboral
- Edad
- Sexo
- Nivel educacional
- Ingresos
- Segregación territorial (Santiago vs otras regiones)
- Aislamiento territorial:
    -   Promedio años escolaridad de sostenedores en 1 km a la redonda #preferir desv estándar#
    -   Número de trabajadores/as (ocupados??) en 1 km a la redonda #usar también inactivos#
    -   Número de cesantes en 1 km a la redonda
    -   Acceso areas verdes en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a colegios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a servicios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
- pertenencia pueblo indígena
- condición de migración

## Inclusion laboral
```{r}
data$informal <- factor(data$informal_w03, levels = c(0,1), labels = c("Formal", "Informal"))
clase.informal = sjPlot::sjt.xtab(data$lclass, data$informal,
                              var.labels = c("Clases de cohesion social", "Tipo de empleo"),
                              show.obs = T,
                              show.cell.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.informal

```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$informal))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$informal),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablaformal <- tabla2 %>% filter(Var2=="Formal") %>% select(Freq)
tablaformaltot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Formal") %>% select(Freq)
tablaformal <- rbind(tablaformal, tablaformaltot)

tablainformal <- tabla2 %>% filter(Var2=="Informal") %>% select(Freq)
tablainformaltot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Informal") %>% select(Freq)
tablainformal <- rbind(tablainformal, tablainformaltot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablaformal, 
               tablainformal,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Formal",
                            "Informal",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Tipo de empleo"= 3))
```

## Edad
```{r include=F}
data$m0_edad_w03 <- car::recode(data$m0_edad_w03, "18:29=1; 30:39=2; 40:49=3; 50:59=4; 60:83=5")
data$edad <- factor(data$m0_edad_w03, levels = c(1,2,3,4,5), labels = c("Entre 18 y 29", "Entre 30 y 39", "Entre 40 y 49", "Entre 50 y 59", "Mas de 60"))
table(data$edad)
```

```{r}
clase.edad = sjPlot::sjt.xtab(data$lclass, data$edad,
                              var.labels = c("Clases de cohesion social", "Edad en tramos"),
                              show.obs = T,
                              show.cell.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.edad
```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$edad))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$edad),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablae1 <- tabla2 %>% filter(Var2=="Entre 18 y 29") %>% select(Freq)
tablae1tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Entre 18 y 29") %>% select(Freq)
tablae1 <- rbind(tablae1, tablae1tot)

tablae2 <- tabla2 %>% filter(Var2=="Entre 30 y 39") %>% select(Freq)
tablae2tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Entre 30 y 39") %>% select(Freq)
tablae2 <- rbind(tablae2, tablae2tot)

tablae3 <- tabla2 %>% filter(Var2=="Entre 40 y 49") %>% select(Freq)
tablae3tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Entre 40 y 49") %>% select(Freq)
tablae3 <- rbind(tablae3, tablae3tot)

tablae4 <- tabla2 %>% filter(Var2=="Entre 50 y 59") %>% select(Freq)
tablae4tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Entre 50 y 59") %>% select(Freq)
tablae4 <- rbind(tablae4, tablae4tot)

tablae5 <- tabla2 %>% filter(Var2=="Mas de 60") %>% select(Freq)
tablae5tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Mas de 60") %>% select(Freq)
tablae5 <- rbind(tablae5, tablae5tot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablae1, 
               tablae2,
               tablae3, 
               tablae4, 
               tablae5, 
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Entre 18 y 29",
                            "Entre 30 y 39",
                            "Entre 40 y 49",
                            "Entre 50 y 59",
                            "Mas de 60",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Grupos de edad"= 6))
```

## Sexo

```{r}
clase.sexo = sjPlot::sjt.xtab(data$lclass, data$m0_sexo_w03,
                              var.labels = c("Clases de cohesion social", "Sexo"),
                              show.obs = T,
                              show.cell.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.sexo


```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$m0_sexo_w03))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$m0_sexo_w03),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2==1) %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2==1) %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2==2) %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2==2) %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Hombre",
                            "Mujer",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Sexo"= 3))
```

## Nivel educacional
```{r}
clase.educacion = sjPlot::sjt.xtab(data$lclass,data$m01_w03,
                           var.labels = c("Clases de cohesión social", "Nivel educacional"),
                           show.obs = T,
                           show.cell.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.educacion

```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$m01_w03))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$m01_w03),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablae1 <- tabla2 %>% filter(Var2=="Educacion basica o menos") %>% select(Freq)
tablae1tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Educacion basica o menos") %>% select(Freq)
tablae1 <- rbind(tablae1, tablae1tot)

tablae2 <- tabla2 %>% filter(Var2=="Educacion media") %>% select(Freq)
tablae2tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Educacion media") %>% select(Freq)
tablae2 <- rbind(tablae2, tablae2tot)

tablae3 <- tabla2 %>% filter(Var2=="Educacion tecnica superior") %>% select(Freq)
tablae3tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Educacion tecnica superior") %>% select(Freq)
tablae3 <- rbind(tablae3, tablae3tot)

tablae4 <- tabla2 %>% filter(Var2=="Educacion universitaria y Postgrado") %>% select(Freq)
tablae4tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Educacion universitaria y Postgrado") %>% select(Freq)
tablae4 <- rbind(tablae4, tablae4tot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablae1, 
               tablae2,
               tablae3, 
               tablae4, 
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Educacion basica o menos",
                            "Educacion media",
                            "Educacion tecnica superior",
                            "Educacion universitaria o Postgrado",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Nivel educacional"= 5))
```

## Ingresos del hogar en quintiles
```{r}
clase.ingreso = sjPlot::sjt.xtab(data$lclass,data$quintiles_ingresos_w03,
                           var.labels = c("Clases de cohesión social", "Quintiles de ingresos"),
                           show.obs = T,
                           show.cell.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.ingreso
```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$quintiles_ingresos_w03))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$quintiles_ingresos_w03),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablae1 <- tabla2 %>% filter(Var2=="Quintil 1") %>% select(Freq)
tablae1tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Quintil 1") %>% select(Freq)
tablae1 <- rbind(tablae1, tablae1tot)

tablae2 <- tabla2 %>% filter(Var2=="Quintil 2") %>% select(Freq)
tablae2tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Quintil 2") %>% select(Freq)
tablae2 <- rbind(tablae2, tablae2tot)

tablae3 <- tabla2 %>% filter(Var2=="Quintil 3") %>% select(Freq)
tablae3tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Quintil 3") %>% select(Freq)
tablae3 <- rbind(tablae3, tablae3tot)

tablae4 <- tabla2 %>% filter(Var2=="Quintil 4") %>% select(Freq)
tablae4tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Quintil 4") %>% select(Freq)
tablae4 <- rbind(tablae4, tablae4tot)

tablae5 <- tabla2 %>% filter(Var2=="Quintil 5") %>% select(Freq)
tablae5tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Quintil 5") %>% select(Freq)
tablae5 <- rbind(tablae5, tablae5tot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablae1, 
               tablae2,
               tablae3, 
               tablae4, 
               tablae5, 
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Quintil 1",
                            "Quintil 2",
                            "Quintil 3",
                            "Quintil 4",
                            "Quintil 5",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Quintiles de ingresos"= 6))
```

## Segregación territorial
```{r}
clase.region = sjPlot::sjt.xtab(data$lclass,data$region_w03,
                           var.labels = c("Clases de cohesión social", "Region"),
                           show.obs = T,
                           show.cell.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.region
```

```{r include=F}
tabla1 <- addmargins(table(data$region_w03, data$lclass))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$region_w03, data$lclass),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablae1 <- tabla2 %>% filter(Var2=="Institucional") %>% select(Freq)
tablae1tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Institucional") %>% select(Freq)
tablae1 <- rbind(tablae1, tablae1tot)

tablae2 <- tabla2 %>% filter(Var2=="Movilizado") %>% select(Freq)
tablae2tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Movilizado") %>% select(Freq)
tablae2 <- rbind(tablae2, tablae2tot)

tablae3 <- tabla2 %>% filter(Var2=="Atomizado") %>% select(Freq)
tablae3tot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Atomizado") %>% select(Freq)
tablae3 <- rbind(tablae3, tablae3tot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Antofagasta",
                            "Araucania",
                            "Atacama",
                            "Aysen",
                            "Bio Bio",
                            "Coquimbo",
                            "Lib. Gral. B. Ohiggins",
                            "Los Lagos",
                            "Los Rios",
                            "Maule",
                            "Metropolitana",
                            "Tarapaca",
                            "Valparaiso",
                        "N=100%"),
               tablae1, 
               tablae2,
               tablae3,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Institucional",
                        "Movilizado",
                        "Atomizado",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Region"= 4))
```


## Etnia

```{r}
clase.etnia = sjPlot::sjt.xtab(data$lclass,data$etnia_rec,
                           var.labels = c("Clases de cohesión social", "Etnia"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.etnia
```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$etnia_rec))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$etnia_rec),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="Ninguna") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Ninguna") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="Pertenece a una etnia") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Pertenece a una etnia") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Ninguna",
                            "Pertenece a una etnia",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Etnia"= 3))
```

## Condicion de migracion
```{r}
clase.nacion = sjPlot::sjt.xtab(data$lclass,data$nacion_rec,
                           var.labels = c("Clases de cohesión social", "Nacion"),
                           show.obs = T,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.nacion

```

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$nacion_rec))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$nacion_rec),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="Nacionalidad chilena") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Nacionalidad chilena") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="Otra nacionalidad") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="Otra nacionalidad") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Nacionalidad chilena",
                            "Otra nacionalidad",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Nacionalidad"= 3))
```

## Habilitadores territoriales

- SD del promedio de años de escolaridad de sostenedor del hogar 1km a la redonda


```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_sded))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_sded),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Promedio de años de escolaridad sostenedor del hogar (sd)"= 3))
```

- Número de trabajadores/as (ocupados??) en 1 km a la redonda  trab_1k

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_ocupados))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_ocupados),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Cantidad de trabajadores ocupados"= 3))
```

Número de cesantes en 1 km a la redonda cesa_1k

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_cesantes))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_cesantes),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Cantidad de trabajadores buscando empleo"= 3))
```

Número de inactivos

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_inactivo))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_inactivo),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Cantidad de trabajadores inactivos"= 3))
```

Acceso areas verdes en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? acver_mnz

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_acver))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_acver),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Acceso a areas verdes"= 3))
```

Acceso a colegios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? aced_mnz

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_aced))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_aced),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Acceso a colegios"= 3))
```

Acceso a servicios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? accs_mnz

```{r include=F}
tabla1 <- addmargins(table(data$lclass, data$percent_accs))
tabla1 <- as.data.frame(tabla1)
tabla2 <- round(prop.table(table(data$lclass, data$percent_accs),2),3)*100
tabla2 <- as.data.frame(tabla2)

tablah <- tabla2 %>% filter(Var2=="1") %>% select(Freq)
tablahtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="1") %>% select(Freq)
tablah <- rbind(tablah, tablahtot)

tablam <- tabla2 %>% filter(Var2=="2") %>% select(Freq)
tablamtot <- tabla1 %>% filter(Var1=="Sum" & Var2=="2") %>% select(Freq)
tablam <- rbind(tablam, tablamtot)

tablatotal <- tabla1 %>% filter(Var2=="Sum") %>% select(Freq)

collapse_rows_cohesion <-
    data.frame(vars = c("Institucional",
                        "Movilizado",
                        "Atomizado",
                        "N=100%"),
               tablah, 
               tablam,
               tablatotal)

```

```{r echo=FALSE, fig.align = 'center', out.width = '100%',out.height='100%'}
knitr::kable(collapse_rows_cohesion, "html",
             col.names =  c("Clases de cohesión social",
                            "Cuartil 1 al 3",
                            "Cuartil 4",
                            "N=100%"
                            )) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  kableExtra::add_header_above(header = c(" "=1, "Acceso a servicios publicos"= 3))
```