---
title: "analisis-habilitadores"
author: "Equipo CEPAL-ELSOC"
date: "15-09-2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
```


Este código produce los análisis necesarios para el capítulo III del informe CEPAL-COES.

```{r include=FALSE}
# Cargar paquetes
pacman::p_load(dplyr, car, knitr, kableExtra, ggplot2, sjPlot, sjmisc)
```

```{r}
# Cargar base de datos
load("input/data/proc/data_clases.RData")
```

```{r}
table(data$lclass)
```

# Elementos habilitadores
- Inclusión laboral
- Edad
- Sexo
- Nivel educacional
- Ingresos
- Segregación territorial (Santiago vs otras regiones)
- Aislamiento territorial:
    -   Promedio años escolaridad de sostenedores en 1 km a la redonda #preferir desv estándar#
    -   Número de trabajadores/as (ocupados??) en 1 km a la redonda #usar también inactivos#
    -   Número de cesantes en 1 km a la redonda
    -   Acceso areas verdes en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a colegios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a servicios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
- pertenencia pueblo indígena
- condición de migración

## Inclusion laboral
```{r}
data$informal <- factor(data$informal_w03, levels = c(0,1), labels = c("Formal", "Informal"))
clase.informal = sjPlot::sjt.xtab(data$lclass, data$informal,
                              var.labels = c("Clases de cohesion social", "Tipo de empleo"),
                              show.obs = T,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.informal


```



## Edad
```{r}
frq(data$m0_edad_w03)

data$m0_edad_w03 <- car::recode(data$m0_edad_w03, "18:29=1; 30:39=2; 40:49=3; 50:59=4; 60:83=5")
data$edad <- factor(data$m0_edad_w03, levels = c(1,2,3,4,5), labels = c("Entre 18 y 29", "Entre 30 y 39", "Entre 40:49", "Entre 50:59", "Mas de 60"))
table(data$edad)
```

```{r}
clase.edad = sjPlot::sjt.xtab(data$lclass, data$edad,
                              var.labels = c("Clases de cohesion social", "Edad en tramos"),
                              show.obs = F,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.edad
```

## Sexo

```{r}
clase.sexo = sjPlot::sjt.xtab(data$lclass, data$m0_sexo_w03,
                              var.labels = c("Clases de cohesion social", "Sexo"),
                              show.obs = F,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.sexo


```


## Nivel educacional
```{r}
clase.educacion = sjPlot::sjt.xtab(data$lclass,data$m01_w03,
                           var.labels = c("Clases de cohesión social", "Nivel educacional"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.educacion

```

## Ingresos del hogar en quintiles
```{r}
clase.ingreso = sjPlot::sjt.xtab(data$lclass,data$quintiles_ingresos_w03,
                           var.labels = c("Clases de cohesión social", "Quintiles de ingresos"),
                           show.obs = T,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.ingreso


```

## Segregación territorial
```{r}
table(data$region) 
data$region <- ifelse(data$region_w03=="Metropolitana", 1, 2)
data$region <- factor(data$region, levels = c(1,2), labels = c("Metropolitana", "Otra region"))

clase.region = sjPlot::sjt.xtab(data$lclass,data$region,
                           var.labels = c("Clases de cohesión social", "Region"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.region


```

## Etnia

```{r}
clase.etnia = sjPlot::sjt.xtab(data$lclass,data$etnia_rec,
                           var.labels = c("Clases de cohesión social", "Etnia"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.etnia


```

## Condicion de migracion
```{r}
clase.nacion = sjPlot::sjt.xtab(data$lclass,data$nacion_rec,
                           var.labels = c("Clases de cohesión social", "Nacion"),
                           show.obs = T,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.nacion

```

## Habilitadores territoriales

- SD del promedio de años de escolaridad de sostenedor del hogar 1km a la redonda

```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.sdeduc <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, sded_1k)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Desviacion estandar del promedio de años de escolaridad
de sostenedores del hogar 1km a la redonda")
clase.sdeduc

ggsave(clase.sdeduc, file = "bookdown-files/output/graphs/clase-sdeduc.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

- Número de trabajadores/as (ocupados??) en 1 km a la redonda  trab_1k
```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.trab <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, trab_1k)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Cantidad de trabajadores ocupados 
en 1km a la redonda")
clase.trab

ggsave(clase.trab, file = "bookdown-files/output/graphs/clase-trab.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

Número de cesantes en 1 km a la redonda cesa_1k
```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.cesantes <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, cesa_1k)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Cantidad de cesantes en 1km a la redonda")
clase.cesantes

ggsave(clase.cesantes, file = "bookdown-files/output/graphs/clase-cesantes.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```
Acceso areas verdes en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? acver_mnz
```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.acver <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, acver_mnz)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Acceso a areas verdes en un radio
de 15min a pie")
clase.acver

ggsave(clase.acver, file = "bookdown-files/output/graphs/clase-acver.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```
Acceso a colegios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? aced_com
```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.aced <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, aced_com)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Acceso a colegios en un radio
de 15min a pie a nivel de comuna")
clase.aced

ggsave(clase.aced, file = "bookdown-files/output/graphs/clase-aced.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```
Acceso a servicios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad? accs_mnz
```{r}
windowsFonts("Arial" = windowsFont("Arial"))
clase.accs <- data  %>% filter(lclass!=is.na(lclass)) %>% 
  ggplot(aes(lclass, accs_mnz)) +
  geom_boxplot(fill = "lightgray", color = "darkred") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "steelblue") +
     theme(plot.caption = element_text(hjust = 0)) +
  labs(caption = "Fuente: elaboracion propia en base a datos de ELSOC 2016-2020",
       x="Clases de cohesion social", y= "Acceso a servicios en un radio
de 15min a pie")
clase.accs

ggsave(clase.accs, file = "bookdown-files/output/graphs/clase-accs.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```