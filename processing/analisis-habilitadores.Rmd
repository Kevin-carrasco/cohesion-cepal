---
title: "analisis-habilitadores"
author: "Equipo CEPAL-ELSOC"
date: "15-09-2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
```


Este código produce los análisis necesarios para el capítulo III del informe CEPAL-COES.

```{r include=FALSE}
# Cargar paquetes
pacman::p_load(dplyr, car, knitr, kableExtra, ggplot2, sjPlot, sjmisc)
```

```{r}
# Cargar base de datos
load("input/data/proc/data_clases.RData")
```

```{r}
data$lclass <- factor(data$lclass, levels = c(1,2,3), labels = c("Institucional", "Movilizado", "Atomizado"))
table(data$lclass)
```

# Elementos habilitadores
- Inclusión laboral
- Edad
- Sexo
- Nivel educacional
- Ingresos
- Segregación territorial (Santiago vs otras regiones)
- Aislamiento territorial:
    - Promedio años escolaridad de sostenedores en 1 km a la redonda #preferir desv estándar#
    -   Número de trabajadores/as (ocupados??) en 1 km a la redonda #usar también inactivos#
    -   Número de cesantes en 1 km a la redonda
    -   Acceso areas verdes en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a colegios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
    -   Acceso a servicios en radio de 15 min a pie #aclarar definición# ¿media de la ciudad?
- pertenencia pueblo indígena
- condición de migración

## Inclusion laboral
```{r}
data$informal <- factor(data$informal_w03, levels = c(0,1), labels = c("Formal", "Informal"))
clase.informal = sjPlot::sjt.xtab(data$lclass, data$informal,
                              var.labels = c("Clases de cohesion social", "Tipo de empleo"),
                              show.obs = F,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.informal
```



## Edad
```{r}
frq(data$m0_edad_w03)

data$m0_edad_w03 <- car::recode(data$m0_edad_w03, "18:29=1; 30:39=2; 40:49=3; 50:59=4; 60:83=5")
data$edad <- factor(data$m0_edad_w03, levels = c(1,2,3,4,5), labels = c("Entre 18 y 29", "Entre 30 y 39", "Entre 40:49", "Entre 50:59", "Mas de 60"))
table(data$edad)
```

```{r}
clase.edad = sjPlot::sjt.xtab(data$lclass, data$edad,
                              var.labels = c("Clases de cohesion social", "Edad en tramos"),
                              show.obs = F,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.edad
```

## Sexo

```{r}
clase.sexo = sjPlot::sjt.xtab(data$lclass, data$m0_sexo_w03,
                              var.labels = c("Clases de cohesion social", "Sexo"),
                              show.obs = F,
                              show.col.prc = T,
                              show.summary = F,
                              prc.sign = "", string.total="N=100%")
clase.sexo


```


## Nivel educacional
```{r}
clase.educacion = sjPlot::sjt.xtab(data$lclass,data$m01_w03,
                           var.labels = c("Clases de cohesión social", "Nivel educacional"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.educacion

```

## Ingresos del hogar en quintiles
```{r}
clase.ingreso = sjPlot::sjt.xtab(data$lclass,data$quintiles_ingresos_w03,
                           var.labels = c("Clases de cohesión social", "Quintiles de ingresos"),
                           show.obs = T,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.ingreso


```

## Segregación territorial
```{r}
table(data$region) 
data$region <- ifelse(data$region_w03=="Metropolitana", 1, 2)
data$region <- factor(data$region, levels = c(1,2), labels = c("Metropolitana", "Otra region"))

clase.region = sjPlot::sjt.xtab(data$lclass,data$region,
                           var.labels = c("Clases de cohesión social", "Region"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.region


```

## Etnia

```{r}
clase.etnia = sjPlot::sjt.xtab(data$lclass,data$etnia_rec,
                           var.labels = c("Clases de cohesión social", "Etnia"),
                           show.obs = F,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.etnia


```

## Condicion de migracion
```{r}
clase.nacion = sjPlot::sjt.xtab(data$lclass,data$nacion_rec,
                           var.labels = c("Clases de cohesión social", "Nacion"),
                           show.obs = T,
                           show.col.prc=T,
                           show.summary=F,
                           prc.sign = "", string.total="N=100%")
clase.nacion

```

