---
title: "Capitulo I: Medición de cohesión social con ELSOC según modelo CEPAL"
author: "Equipo CEPAL-ELSOC"
date: "10-07-2021"
output:
  html_document:
    number_sections: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
```


```{r include=FALSE}
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools)
```


```{r include=FALSE}
# Cargar base elsoc longitudinal (2016-2019) creada en "preparacion"
load("../input/data/data.RData")
# Filtrar base por casos participantes en cuatro olas
data <- data %>% dplyr::filter(tipo_atricion==1 & tipo_caso !=2)
```
<div style="text-align: justify">

El objetivo de este primer capítulo es generar indicadores de cohesión social basados en el modelo conceptual de CEPAL, en particular para los denominados _elementos constitutivos de la cohesión social_ y que se presenta en la \@ref(fig:esquema-cepal).

```{r echo=FALSE, fig.cap="esquema-cepal: Resumen dimensiones CEPAL.", fig.align = 'center', out.width = '70%',out.height='70%'}
knitr::include_graphics(path = "../input/images/dimensiones-cepal.jpg")
```

En este capítulo se seleccionarán indicadores de la encuesta ELSOC (Estudio Longitudinal Social de Chile) que se asocien al contenido de cada una de las subdimensiones del concepto de cohesión social. Por ejemplo, si consideramos la dimensión "Relaciones Sociales de Igualdad", comenzaremos con la subdimensión "lazos" identificando indicadores de la encuesta que representen este concepto, y con la información disponible elaboraremos una propuesta para cubrir cada subdimensión.

Antes de comenzar con el trabajo de análisis de subdimensiones e indicadores, es pertinente mencionar una pequeña nota sobre medición. En este contexto medición hace referencia a otorgar propiedades numéricas a ciertos atributos individuales. Este proceso por definición no es exacto y conlleva error, ya que muchos de los conceptos que se trabajan en ciencias sociales no se pueden medir directamente y se consideran por lo tanto constructos latentes (como clase, estatus, pertenencia, confianza, entre muchos otros). Gran parte del trabajo de validez de las mediciones se trata justamente de poder cuantificar y minimizar este error. Para esto no solo basta con un análisis de _validez aparente_, referido a que el contenido de la medición parezca relacionarse con el concepto que se desea medir, sino también con las propiedades métricas del indicador, como variabilidad y covariabilidad/correlación con otras medidas asociadas. Es por ello que en medición muchas veces se utilizan indicadores múltiples para un mismo concepto, de modo de poder identificarlo y estimarlo de una manera más robusta con técnicas específicas de análisis de constructos latentes.

[evaluar si es necesario dar más detalles de medición]

La breve mención a aspectos de medición del párrafo anterior nos permite aclarar el orden y el sentido del análisis que se presenta a continuación. En algunos casos encontraremos indicadores únicos para subdimensiones, donde no existe mayor alternativa que discutir su validez aparente y esperar un bajo nivel de error de medición. En otros casos existen baterías de indicadores múltiples, donde se propondrán índices que representen de mejor manera los elementos comunes (covarianza) y que subyacen a la batería, para lo que se utilizarán técnicas de análisis factorial.


# Elementos constitutivos de la cohesión social

## Relaciones sociales de igualdad

[definición] De acuerdo a CEPAL, "Esta  parte de la definición de la cohesión social se acerca a aquellas que conciben la cohesión social como el  compromiso y habilidad para trabajar juntos, incluso cuando los valores que poseen las personas sean  distintos (Comisión Económica para África, 2016; Pornschlegel y Jürgensen, 2019; Dragolov y otros, 2013; De  Beer, 2014; Woolcock, 2011; Banco Mundial, 2012, 2000; Stanley, 2003). Supone asimismo el principio de  reconocimiento recíproco como precondición de la cohesión social (véase, por ejemplo, Jenson, 1998), así  como la superación de todas las formas de discriminación." (CEPAL 2021? pag. ?)

### Lazos

[definición] 

El indicador propuesto en el informe de CEPAL es "importancia de amigos en la vida". En el caso de ELSOC el indicador más cercano corresponde a  "Cantidad de amigos", y que está presente solo en las olas 2 y 4.

```{r echo=FALSE}
tabla1 = data %>% select(r15_w02) %>% na_if("") %>% na.omit
tabla1 = droplevels(tabla1)
tabla1$r15_w02 <- factor(tabla1$r15_w02, levels = c(1, 2, 3, 4, 5), labels = c("No tiene amigos ni amigas", "De 1 a 2",
"De 3 a 5", "De 6 a 10", "Más de 10"))
label(tabla1$r15_w02) <- "Cantidad de amigos (2017)"

graf1<-  plot_stackfrq(tabla1, title = "Lazos") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")
graf1
ggsave(graf1, file = "../output/graphs/lazos.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

### Confianza interpersonal
En el informe de CEPAL se utilizan los indicadores "Confianza en la gente de su comunidad" y "Confianza en la gente que se conoce por primera vez". Al trabajar con ELSOC se utilizará "Se puede confiar en la mayoría de las personas", "La mayoría de las personas tratar de ayudar a los demás" y "la mayoría de la gente trata de ser justa", presentes en las cuatro olas.

```{r echo=FALSE}
tabla2 = data %>% select(c02_w01, c03_w01, c04_w01)
tabla2 = droplevels(tabla2)
tabla2$c02_w01 <- recode(tabla2$c02_w01, "1=3; 2=1; 3=2")
tabla2$c03_w01 <- recode(tabla2$c03_w01, "1=3; 2=1; 3=2")
tabla2$c04_w01 <- recode(tabla2$c04_w01, "1=1; 2=3; 3=2")
tabla2$c02_w01<- factor(tabla2$c02_w01, levels = c(1, 2, 3), labels = c("No", "Depende", "Si"))
tabla2$c03_w01<- factor(tabla2$c03_w01, levels = c(1, 2, 3), labels = c("No", "Depende", "Si"))
tabla2$c04_w01<- factor(tabla2$c04_w01, levels = c(1, 2, 3), labels = c("No", "Depende", "Si"))
label(tabla2$c02_w01) <- "Se puede confiar en la mayoría de las personas (2016)."
label(tabla2$c03_w01) <- "La mayoría de las personas tratar de ayudar a los demás (2016)."
label(tabla2$c04_w01) <- "La mayoría de las personas trata de ser justa (2016)."

graf2 <- plot_stackfrq(tabla2, title = "Confianza interpersonal", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")
graf2

ggsave(graf2, file = "../output/graphs/confianza-interpersonal.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/confianza-interpersonal_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c02_w01, c03_w01, c04_w01),
                   method="spearman",
                   use = "na.or.complete"))
dev.off()
```

### Reconocimiento y respeto de la diversidad
En el informe de CEPAL se utilizan dos indicadores "aprueba el derecho a contraer matrimonio de parejas del mismo sexo" y "Los hombres no tienen prioridad sobre la mujer, a la hora acceder a un trabajo" y se deja como pendiente la construcción de un indicador sobre tolerancia a personas de distinta raza y etnia, así como de percepción de discriminación. En este sentido, ante la falta de indicadores de ELSOC, se utilizarán los propuestos en [informe clases medias] como Actitudes hacia la diversidad: Los dos primeros en las cuatro olas, adopción homoparental en olas 3 y 4 y el resto en ola 2 y 4.

```{r echo=FALSE}
tabla3 = data %>% select(r12_03_w01, r12_04_w01, c37_01_w03)
tabla3 = droplevels(tabla3)
tabla3$r12_03_w01<- factor(tabla3$r12_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla3$r12_04_w01<- factor(tabla3$r12_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla3$c37_01_w03<- factor(tabla3$c37_01_w03, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
label(tabla3$r12_03_w01) <- "Chile pierde su identidad con la llegada de inmigrantes (2016)."
label(tabla3$r12_04_w01) <- "Con la llegada de inmigrantes aumenta el desempleo (2016)."
label(tabla3$c37_01_w03) <- "Grado de acuerdo con adopción homoparental (2018)."

graf3<- plot_stackfrq(tabla3, title = "Actitudes hacia la diversidad", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf3
ggsave(graf3, file = "../output/graphs/prejuicios.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
tabla4 = data %>% select(c06_04_w01, c06_05_w01, c06_06_w01)
tabla4 = droplevels(tabla4)
tabla4$c06_04_w01<- factor(tabla4$c06_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla4$c06_05_w01<- factor(tabla4$c06_05_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla4$c06_06_w01<- factor(tabla4$c06_06_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
label(tabla4$c06_04_w01) <- "Grado de confianza con personas homosexuales (2016)."
label(tabla4$c06_05_w01) <- "Grado de confianza con personas mapuche (2016)."
label(tabla4$c06_06_w01) <- "Grado de confianza con personas inmigrantes (2016)."

graf4<- plot_stackfrq(tabla4, title = "Actitudes hacia la diversidad") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf4
ggsave(graf4, file = "../output/graphs/diversidad.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/diversidad_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, r12_03_w01, r12_04_w01, c37_01_w03, c06_04_w01, c06_05_w01, c06_06_w01),
                   use = "na.or.complete",
                   method = "spearman"))
dev.off()
```

El ajuste de la dimensión Relaciones sociales de igualdad se estimó a través de un AFC. Esta dimensión logra su mejor ajuste al separarla en cuatro subdimensiones: a) Lazos; b) confianza interpersonal; c) Reconocimiento y respeto hacia la diversidad; y d) prejuicios hacia inmigrantes.
Además, se excluye el indicador de "Grado de confianza en inmigrantes" de la subdimensión Reconocimiento y respeto hacia la diversidad.

```{r include=FALSE}
# crear una base de datos con menos variables para estimar los AFC
relaciones_sociales = data %>%
  dplyr::select(r15_w02, c02_w01, c03_w01, c04_w01, r12_03_w01, r12_04_w01, c06_04_w01, c06_05_w01, c06_06_w01) %>%
  as.data.frame() %>%
  na.omit()
```
```{r include=FALSE}
## c06_06_w01 (Grado de confianza en inmigrantes) queda fuera por Mi alto (99.731)
cfa_1c <- '
lazos =~ r15_w02
confianza =~ c02_w01 + c03_w01 + c04_w01
prejuicios =~ r12_03_w01 + r12_04_w01
diversidad =~ c06_04_w01 + c06_05_w01
'
fit_1c <- cfa(cfa_1c,data=relaciones_sociales,missing="ML",estimator="MLR")
show(fit_1c) # Resumen ajuste general
summary(fit_1c, fit.measures=T, standardized=T)
```
```{r echo=FALSE}
fitMeasures(fit_1c, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
# Buen ajuste
```
```{r echo=FALSE}
semPaths(fit_1c, intercepts = FALSE,edge.label.cex=1.5, optimizeLatRes = TRUE, groups = "lat",pastel = TRUE, exoVar = FALSE, sizeInt=5,edge.color ="black",esize = 6, label.prop=2,sizeLat = 6,"std", layout="circle2")
```

## Sentido de pertenencia

Una segunda dimensión de la definición propuesta corresponde al sentido de pertenencia, que "alude a la vinculación e identificación de las personas respecto a la sociedad y a las instituciones y grupos que los integran. Incluye los niveles micro, meso y macro." (CEPAL 2021? pag. ?). Esta definición permite relevar la importancia de "las dinámicas de reconocimiento y participación social para conducir procesos dinámicos de inclusión que contribuyan a la cohesión social y al logro del bienestar (véase, por ejemplo, Jenson, 1998; Kymlicka, 1998)." (CEPAL 2021? pag. ?)

### Identificación con el país
En el informe CEPAL se incluyen los indicadores "Orgullo por el sistema político" y "Orgullo por su nacionalidad". Al trabajar con ELSOC se utilizará "Orgullo de ser chileno" e "Identificación con Chile" que están presentes en las cuatro olas.

```{r echo=FALSE}
tabla5 = data %>% select(c32_01_w01,c32_02_w01)
tabla5 = droplevels(tabla5)
tabla5$c32_01_w01<- factor(tabla5$c32_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla5$c32_02_w01<- factor(tabla5$c32_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
label(tabla5$c32_01_w01) <- "Me siento orgulloso de ser chileno (2016)."
label(tabla5$c32_02_w01) <- "Me identifico con Chile (2016)."

graf5<-plot_stackfrq(tabla5, title = "Identificación con el país", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf5
ggsave(graf5, file = "../output/graphs/identificacion.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/identificacion_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c32_01_w01, c32_02_w01),
                            use = "na.or.complete"))
dev.off()
```

### Percepción de justicia
En informe CEPAL se utilizan los indicadores "Se deben equiparar los sueldos, no mantener desigualdad para incentivar el esfuerzo personal", "El trabajo a largo plazo da beneficios, no las conexiones o suerte", "El Estado debe implementar políticas para reducir la desigualdad de ingreso". Al trabajar con ELSOC se utilizan "En Chile las personas son recompensadas por su esfuerzo" y "En Chile las personas son recompensadas por su inteligencia", presentes en todas las olas

```{r echo=FALSE}
tabla6 = data %>% select(c18_09_w01,c18_10_w01)
tabla6 = droplevels(tabla6)
tabla6$c18_09_w01<- factor(tabla6$c18_09_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla6$c18_10_w01<- factor(tabla6$c18_10_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
label(tabla6$c18_09_w01) <- "En Chile las personas son recompensadas por sus esfuerzos (2016)."
label(tabla6$c18_10_w01) <- "En Chile las personas son recompensadas por su inteligencia (2016)."

graf6<-plot_stackfrq(tabla6, title = "Percepción de justicia", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf6
ggsave(graf6, file = "../output/graphs/justicia.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/justicia_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c18_09_w01, c18_10_w01),
                   method = "spearman",
                   use = "na.or.complete"))
dev.off()
```

### Confianza institucional
En informe CEPAL utilizan grado de confianza en (a) las cortes, (b) el Congreso Nacional, (c) la Policía Nacional, (d) los partidos políticos, (e) el ejecutivo y (f) las elecciones. Al trabajar con ELSOC se utilizan los siguientes ocho indicadores que están presentes en las cuatro olas

```{r echo=FALSE}
tabla7 = data %>% select(c05_01_w01,
                         c05_02_w01,
                         c05_03_w01,
                         c05_04_w01,
                         c05_05_w01,
                         c05_06_w01,
                         c05_07_w01,
                         c05_08_w01)
tabla7 = droplevels(tabla7)
tabla7$c05_01_w01<- factor(tabla7$c05_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_02_w01<- factor(tabla7$c05_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_03_w01<- factor(tabla7$c05_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_04_w01<- factor(tabla7$c05_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_05_w01<- factor(tabla7$c05_05_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_06_w01<- factor(tabla7$c05_06_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_07_w01<- factor(tabla7$c05_07_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
tabla7$c05_08_w01<- factor(tabla7$c05_08_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nada de confianza", "Poca confianza", "Algo de confianza", "Bastante confianza", "Mucha confianza"))
label(tabla7$c05_01_w01) <- "Confianza en el gobierno (2016)."
label(tabla7$c05_02_w01) <- "Confianza en los partidos políticos (2016)."
label(tabla7$c05_03_w01) <- "Confianza en Carabineros (2016)."
label(tabla7$c05_04_w01) <- "Confianza en los sindicatos (2016)."
label(tabla7$c05_05_w01) <- "Confianza en el poder judicial (2016)."
label(tabla7$c05_06_w01) <- "Confianza en las empresas privadas (2016)."
label(tabla7$c05_07_w01) <- "Confianza en el congreso nacional (2016)."
label(tabla7$c05_08_w01) <- "Confianza en el presidente/a de la república (2016)."

graf7 <- plot_stackfrq(tabla7, title = "Confianza institucional") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf7
ggsave(graf7, file = "../output/graphs/confianza-institucional.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/confianza-institucional_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c05_01_w01,
                                 c05_02_w01,
                                 c05_03_w01,
                                 c05_04_w01,
                                 c05_05_w01,
                                 c05_06_w01,
                                 c05_07_w01,
                                 c05_08_w01),
                   method = "spearman",
                   use = "na.or.complete"))
dev.off()
```

El ajuste de la dimensión Sentido de pertenencia se estimó a través de un AFC. Esta dimensión logra su mejor ajuste al ser separada en las tres subdimensiones propuestas por CEPAL: a) Identificación con el país; b) Percepción de justicia; y c) Confianza institucional.
Además, se excluyen los indicadores "Confianza en el presidente/a" y "Confianza en los partidos políticos" de la subdimensión Confianza institucional.
```{r include=FALSE}
# crear una base de datos con menos variables para estimar los AFC
pertenencia = data %>%
  dplyr::select(c32_01_w01, c32_02_w01, c18_09_w01, c18_10_w01, c05_01_w01, c05_02_w01, c05_03_w01, c05_04_w01, c05_05_w01, c05_06_w01, c05_07_w01, c05_08_w01) %>%
  as.data.frame() %>%
  na.omit()
```
```{r include=FALSE}
# Quedan fuera de instituciones c05_02_w01 (confianza en partidos politicos) por "mi" alto
# al estimarse con c05_01_w01 (confianza en el gobierno). (mi=94.961)
cfa_2c <- '
identificacion =~ c32_01_w01 + c32_02_w01
justicia =~ c18_09_w01 + c18_10_w01
instituciones =~ c05_01_w01 + c05_03_w01 + c05_04_w01 + c05_05_w01 + c05_06_w01 + c05_07_w01
'
fit_2c <- cfa(cfa_2c,data=pertenencia,missing="ML",estimator="MLR")
show(fit_2c) # Resumen ajuste general
summary(fit_2c, fit.measures=T, standardized=T)
```
```{r echo=FALSE}
fitMeasures(fit_2c, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
# Buen ajuste
```
```{r echo=FALSE}
semPaths(fit_2c, intercepts = FALSE,edge.label.cex=1.5, optimizeLatRes = TRUE, groups = "lat",pastel = TRUE, exoVar = FALSE, sizeInt=5,edge.color ="black",esize = 6, label.prop=2,sizeLat = 6,"std", layout="circle2")
```

## Orientación hacia el bien común

Esta tercera dimensión refiere a "una actitud favorable a acciones que propendan a un mayor bienestar colectivo versus el beneficio puramente individual como parte de un proyecto compartido, o bien, como indican Sorj y Tironi (2007), aceptar “vivir en un orden colectivo que les reportará beneficios, así como sacrificios individuales”." 

### Solidaridad

En informe CEPAL utilizan el indicador "Asistencia a reuniones de un grupo de mejoras para la comunidad". Al trabajar con ELSOC se utilizará este indicador y otros siete que abordan un comportamiento prosocial y que están presentes en las cuatro olas.

```{r echo=FALSE}
tabla8 = data %>% select(c07_01_w01,
                         c07_02_w01,
                         c07_03_w01,
                         c07_04_w01,
                         c07_05_w01,
                         c07_06_w01,
                         c07_07_w01,
                         c07_08_w01)
tabla8 = droplevels(tabla8)
tabla8$c07_01_w01<- factor(tabla8$c07_01_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_02_w01<- factor(tabla8$c07_02_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_03_w01<- factor(tabla8$c07_03_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_04_w01<- factor(tabla8$c07_04_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_05_w01<- factor(tabla8$c07_05_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_06_w01<- factor(tabla8$c07_06_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_07_w01<- factor(tabla8$c07_07_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
tabla8$c07_08_w01<- factor(tabla8$c07_08_w01, levels = c(1, 2, 3), labels = c("Nunca lo hizo", "Lo hizo una o dos veces", "Lo hizo más de dos veces"))
label(tabla8$c07_01_w01) <- "Ha visitado la casa de algún vecino (2016)."
label(tabla8$c07_02_w01) <- "Ha asistido a alguna reunión donde se traten temas de interés publico o comunitario (2016)."
label(tabla8$c07_03_w01) <- "Han venido amigos a visitarlo a su casa (2016)."
label(tabla8$c07_04_w01) <- "Ha hecho voluntariado (2016)."
label(tabla8$c07_05_w01) <- "Ha donado dinero a una obra social o de caridad (2016)."
label(tabla8$c07_06_w01) <- "Ha prestado una suma de dinero de $10.000.- o más (2016)."
label(tabla8$c07_07_w01) <- "Ha conversado con una persona en problemas o deprimida (2016)."
label(tabla8$c07_08_w01) <- "Ha ayudado a alguien a conseguir trabajo (2016)."

graf8 <- plot_stackfrq(tabla8, title = "Solidaridad") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf8
ggsave(graf8, file = "../output/graphs/solidaridad.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/solidaridad_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c07_01_w01,
                                 c07_02_w01,
                                 c07_03_w01,
                                 c07_04_w01,
                                 c07_05_w01,
                                 c07_06_w01,
                                 c07_07_w01,
                                 c07_08_w01),
                   method = "spearman",
                   use = "na.or.complete"))
dev.off()
```

### Participación cívica
En informe CEPAL se utilizaron los indicadores "Tiene actividad política (firma peticiones, boicot, va a manifestaciones pacíficas, huelgas)", "Participación en organizaciones" y "Voto en elecciones presidenciales". Al trabajar con ELSOC se utilizan cuatro indicadores de actividad política presentes en las cuatro olas, ocho indicadores de participación en organizaciones presentes en ola 1 y 3 y voto en elecciones 2013 y 2017 (ola 1 y 3)

```{r echo=FALSE}
tabla9 = data %>% select(c08_01_w01,
                         c08_02_w01,
                         c08_03_w01,
                         c08_04_w01)
tabla9 = droplevels(tabla9)
tabla9$c08_01_w01<- factor(tabla9$c08_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nunca", "Casi nunca", "A veces", "Frecuentemente", "Muy frecuentemente"))
tabla9$c08_02_w01<- factor(tabla9$c08_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nunca", "Casi nunca", "A veces", "Frecuentemente", "Muy frecuentemente"))
tabla9$c08_03_w01<- factor(tabla9$c08_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nunca", "Casi nunca", "A veces", "Frecuentemente", "Muy frecuentemente"))
tabla9$c08_04_w01<- factor(tabla9$c08_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Nunca", "Casi nunca", "A veces", "Frecuentemente", "Muy frecuentemente"))
label(tabla9$c08_01_w01) <- "Firmado una carta o petición apoyando una causa (2016)."
label(tabla9$c08_02_w01) <- "Asistido a una marcha o manifestación política (2016)."
label(tabla9$c08_03_w01) <- "Participado en una huelga (2016)."
label(tabla9$c08_04_w01) <- "Usado las redes sociales para expresar su opinión en temas públicos (2016)."


graf9 <- plot_stackfrq(tabla9, title = "Participación cívica") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf9
ggsave(graf9, file = "../output/graphs/participacion-civica.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```


```{r echo=FALSE}
png("../output/graphs/participacion-civica_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, c08_01_w01, c08_02_w01, c08_03_w01, c08_04_w01),
                            use = "na.or.complete"))
dev.off()
```

### Participacion en organizaciones
```{r echo=FALSE}
tabla10 = data %>% select(c12_01_w01,
                         c12_02_w01,
                         c12_03_w01,
                         c12_04_w01,
                         c12_05_w01,
                         c12_06_w01,
                         c12_07_w01,
                         c12_08_w01)
tabla10 = droplevels(tabla10)
tabla10$c12_01_w01<- factor(tabla10$c12_01_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_02_w01<- factor(tabla10$c12_02_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_03_w01<- factor(tabla10$c12_03_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_04_w01<- factor(tabla10$c12_04_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_05_w01<- factor(tabla10$c12_05_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_06_w01<- factor(tabla10$c12_06_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_07_w01<- factor(tabla10$c12_07_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla10$c12_08_w01<- factor(tabla10$c12_08_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
label(tabla10$c12_01_w01) <- "Junta de vecinos u otra organización (2016)."
label(tabla10$c12_02_w01) <- "Organización religiosa o Iglesia (2016)."
label(tabla10$c12_03_w01) <- "Partido o movimiento político (2016)."
label(tabla10$c12_04_w01) <- "Sindicato (2016)."
label(tabla10$c12_05_w01) <- "Asociación profesional o gremial (2016)."
label(tabla10$c12_06_w01) <- "Organización deportiva (2016)."
label(tabla10$c12_07_w01) <- "Organización ecológica o medioambiental (2016)."
label(tabla10$c12_08_w01) <- "Asociaciones o centros de estudiantes (2016)."


graf10 <- plot_stackfrq(tabla10, title = "Participación en organizaciones") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf10
ggsave(graf10, file = "../output/graphs/participacion-organizaciones.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

Para estimar esta correlación la categoría "No tenía edad para hacerlo" fue contabilizada como "No"
```{r echo=FALSE}
cor = data %>% select(c12_01_w01,
                         c12_02_w01,
                         c12_03_w01,
                         c12_04_w01,
                         c12_05_w01,
                         c12_06_w01,
                         c12_07_w01,
                         c12_08_w01)
cor$c12_01_w01 <- recode(cor$c12_01_w01, "3=1")
cor$c12_02_w01 <- recode(cor$c12_02_w01, "3=1")
cor$c12_03_w01 <- recode(cor$c12_03_w01, "3=1")
cor$c12_04_w01 <- recode(cor$c12_04_w01, "3=1")
cor$c12_05_w01 <- recode(cor$c12_05_w01, "3=1")
cor$c12_06_w01 <- recode(cor$c12_06_w01, "3=1")
cor$c12_07_w01 <- recode(cor$c12_07_w01, "3=1")
cor$c12_08_w01 <- recode(cor$c12_08_w01, "3=1")


png("../output/graphs/participacion-organizaciones_cor.png",width=600,height=600)
corrplot.mixed(cor(cor,
                   method ="spearman",
                   use = "na.or.complete"))
dev.off()
```

### Participacion electoral

```{r echo=FALSE}
tabla11 = data %>% select(c11_w01, c11_w03)
tabla11 = droplevels(tabla11)
tabla11$c11_w01<- factor(tabla11$c11_w01, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
tabla11$c11_w03<- factor(tabla11$c11_w03, levels = c(1, 2, 3), labels = c("No", "Si", "No tenía edad para hacerlo"))
label(tabla11$c11_w01) <- "Voto en elecciones (2016)."
label(tabla11$c11_w03) <- "Voto en elecciones (2018)."

graf11 <- plot_stackfrq(tabla11, title = "Voto en elecciones") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf11
ggsave(graf11, file = "../output/graphs/participacion-electoral.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

Para estimar esta correlación la categoría "No tenía edad para hacerlo" fue contabilizada como "No".
```{r echo=FALSE}
cor = data %>% select(c11_w01, c11_w03)
cor$c11_w01 <- recode(cor$c11_w01, "3=1")
cor$c11_w03 <- recode(cor$c11_w03, "3=1")

png("../output/graphs/participacion-electoral_cor.png",width=600,height=600)
corrplot.mixed(cor(cor,
                   method="spearman",
                   use = "na.or.complete"))
dev.off()
```

#### No se incluye subdimensión respeto por reglas sociales de la dimensión Orientación hacia el bien comun de informe CEPAL, que posee un indicador de respeto por las instituciones inexistente en ELSOC

El ajuste de la dimensión Orientación hacia el bien común se estimó a través de un AFC. Esta dimensión logra su mejor ajuste al ser separada en cuatro subdimensiones: a) Solidaridad; b) Participación cívica; c) Participación en organizaciones y d) Participación electoral.
Además, se excluyen los indicadores "Han venido amigos a visitarlo a su casa", "Asiste a reuniones sobre temas de interés público", "Ha hecho voluntariado" y "Ha ayudado a alguien a conseguir trabajo" de la subdimensión Solidaridad. El indicador "Participación en huelgas" de la subdimensión Participación cívica y el indicador "Organización religiosa" de la subdimensión Participación en organizaciones.

```{r include=FALSE}
# crear una base de datos con menos variables para estimar los AFC
bien_comun = data %>%
  dplyr::select(c07_01_w01, c07_02_w01, c07_03_w01, c07_04_w01, c07_05_w01, c07_06_w01, c07_07_w01, c07_08_w01, c08_01_w01, c08_02_w01, c08_03_w01, c08_04_w01, c12_01_w01, c12_02_w01, c12_03_w01, c12_04_w01, c12_05_w01, c12_06_w01, c12_07_w01, c12_08_w01, c11_w01) %>%
  as.data.frame() %>%
  na.omit()
## Pasar "no tenia edad" a "no"
bien_comun$c12_01_w01 <- car::recode(bien_comun$c12_01_w01, "3=1")
bien_comun$c12_02_w01 <- car::recode(bien_comun$c12_02_w01, "3=1")
bien_comun$c12_03_w01 <- car::recode(bien_comun$c12_03_w01, "3=1")
bien_comun$c12_04_w01 <- car::recode(bien_comun$c12_04_w01, "3=1")
bien_comun$c12_05_w01 <- car::recode(bien_comun$c12_05_w01, "3=1")
bien_comun$c12_06_w01 <- car::recode(bien_comun$c12_06_w01, "3=1")
bien_comun$c12_07_w01 <- car::recode(bien_comun$c12_07_w01, "3=1")
bien_comun$c12_08_w01 <- car::recode(bien_comun$c12_08_w01, "3=1")
bien_comun$c11_w01 <- car::recode(bien_comun$c11_w01, "3=1")
```


```{r include=FALSE}
# Queda fuera c07_04_w01 (Hizo voluntariado) por "mi" alto (33.027) al estimarse con participacion.
# Y c07_08_w01 (ayudar a conseguir trabajo) por "mi" alto (26.542) al estimarse con c07_05_w01 (dono dinero)
cfa_3d <- '
solidaridad =~ c07_01_w01 + c07_05_w01 + c07_06_w01 + c07_07_w01
participacion =~ c08_01_w01 + c08_02_w01 + c08_04_w01
organizaciones =~ c12_01_w01 + c12_03_w01 + c12_04_w01 + c12_05_w01 + c12_06_w01 + c12_07_w01 + c12_08_w01
voto =~ c11_w01
'
fit_3d <- cfa(cfa_3d,data=bien_comun,missing="ML",estimator="MLR")
show(fit_3d) # Resumen ajuste general
summary(fit_3d, fit.measures=T, standardized=T)
```

```{r echo=FALSE}
fitMeasures(fit_3d, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
# Buen ajuste
```

```{r echo=FALSE}
semPaths(fit_3d, intercepts = FALSE,edge.label.cex=1.5, optimizeLatRes = TRUE, groups = "lat",pastel = TRUE, exoVar = FALSE, sizeInt=5,edge.color ="black",esize = 6, label.prop=2,sizeLat = 6,"std", layout="circle2")
```

## Calidad de vida en el vecindario
De manera adicional, se incorpora una dimensión sobre calidad de vida en el vecindario presente en ELSOC. Todos estos indicadores se encuentran presentes en las cuatro olas.
```{r echo=FALSE}
tabla12 = data %>% select(t01_w01)
tabla12 = droplevels(tabla12)
tabla12$t01_w01<- factor(tabla12$t01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Muy poco", "Poco", "Algo", "Bastante", "Mucho"))

label(tabla12$t01_w01) <- "Confianza en vecinos (2016)."


graf12 <- plot_stackfrq(tabla12, title = "Confianza en vecinos") +
  theme(axis.text.y = element_text(colour = "black", size = 9),
        axis.text.x = element_text(colour = "black", size = 9),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf12
ggsave(graf12, file = "../output/graphs/confianza-vecinos.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
tabla13 = data %>% select(t02_01_w01, t02_02_w01, t02_03_w01, t02_04_w01)
tabla13 = droplevels(tabla13)

tabla13$t02_01_w01<- factor(tabla13$t02_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla13$t02_02_w01<- factor(tabla13$t02_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla13$t02_03_w01<- factor(tabla13$t02_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla13$t02_04_w01<- factor(tabla13$t02_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))

label(tabla13$t02_01_w01) <- "Este barrio es ideal para mi (2016)."
label(tabla13$t02_02_w01) <- "Me siento integrado/a en este barrio (2016)."
label(tabla13$t02_03_w01) <- "Me identifico con la gente de este barrio (2016)."
label(tabla13$t02_04_w01) <- "Este barrio es parte de mi (2016)."

graf13<-plot_stackfrq(tabla13, title = "Cohesion barrial", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf13
ggsave(graf13, file = "../output/graphs/cohesion-barrial.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/cohesion-barrial_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, t02_01_w01, t02_02_w01, t02_03_w01, t02_04_w01),
                            use = "na.or.complete"))
dev.off()
```

```{r echo=FALSE}
tabla14 = data %>% select(t03_01_w01, t03_02_w01, t03_03_w01, t03_04_w01)
tabla14 = droplevels(tabla14)

tabla14$t03_01_w01<- factor(tabla14$t03_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla14$t03_02_w01<- factor(tabla14$t03_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla14$t03_03_w01<- factor(tabla14$t03_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))
tabla14$t03_04_w01<- factor(tabla14$t03_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni en desacuerdo ni de acuerdo", "De acuerdo", "Totalmente de acuerdo"))

label(tabla14$t03_01_w01) <- "En este barrio es fácil hacer amigos (2016)."
label(tabla14$t03_02_w01) <- "La gente en este barrio es sociable (2016)."
label(tabla14$t03_03_w01) <- "La gente en este barrio es cordial (2016)."
label(tabla14$t03_04_w01) <- "La gente en este barrio es colaboradora (2016)."

graf14<-plot_stackfrq(tabla14, title = "Sociabilidad barrial", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf14
ggsave(graf14, file = "../output/graphs/sociabilidad-barrial.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/sociabilidad-barrial_cor.png",width=600,height=600)
corrplot.mixed(cor(dplyr::select(data, t03_01_w01, t03_02_w01, t03_03_w01, t03_04_w01),
                            use = "na.or.complete"))
dev.off()
```

```{r echo=FALSE}
tabla15 = data %>% select(t06_01_w01, t06_02_w01, t06_03_w01, t06_04_w01, t06_05_w01, t06_06_w01, t06_07_w01, t06_08_w01)
tabla15 = droplevels(tabla15)

tabla15$t06_01_w01<- factor(tabla15$t06_01_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_02_w01<- factor(tabla15$t06_02_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_03_w01<- factor(tabla15$t06_03_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_04_w01<- factor(tabla15$t06_04_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_05_w01<- factor(tabla15$t06_05_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_06_w01<- factor(tabla15$t06_06_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_07_w01<- factor(tabla15$t06_07_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))
tabla15$t06_08_w01<- factor(tabla15$t06_08_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente insatisfecho", "Insatisfecho", "Ni satisfecho ni insatisfecho", "Satisfecho", "Totalmente satisfecho"))

label(tabla15$t06_01_w01) <- "Seguridad del barrio (2016)."
label(tabla15$t06_02_w01) <- "Conectividad (2016)."
label(tabla15$t06_03_w01) <- "Areas verdes y de recreacion disponibles (2016)."
label(tabla15$t06_04_w01) <- "Limpieza y belleza del barrio (2016)."
label(tabla15$t06_05_w01) <- "Proximidad al lugar de actividad principal (2016)."
label(tabla15$t06_06_w01) <- "Proximidad a colegios de buena calidad (2016)."
label(tabla15$t06_07_w01) <- "Proximidad a areas de comercio (2016)."
label(tabla15$t06_08_w01) <- "Proximidad con familiares y/o amigos cercanos (2016)."

graf15<-plot_stackfrq(tabla15, title = "Satisfaccion residencial", geom.colors = "RdBu") +
  theme(axis.text.y = element_text(colour = "black", size = 8),
        axis.text.x = element_text(colour = "black", size = 8),
        legend.text = element_text(size = 8),
        legend.position="bottom")

graf15
ggsave(graf15, file = "../output/graphs/satisfaccion-residencial.png",device = "png",width = 25,height = 13,dpi = "retina",units = "cm")
```

```{r echo=FALSE}
png("../output/graphs/satisfaccion-residencial_cor.png",width=600,height=600)
cor_graf15 <- corrplot.mixed(cor(dplyr::select(data, t06_01_w01,
                                 t06_02_w01,
                                 t06_03_w01,
                                 t06_04_w01,
                                 t06_05_w01,
                                 t06_06_w01,
                                 t06_07_w01,
                                 t06_08_w01),
                            use = "na.or.complete"))
dev.off()
```

El ajuste de la dimensión Calidad de vida en el vecindario se estimó a través de un AFC. Esta dimensión logra su mejor ajuste al ser separada en cuatro subdimensiones: a) Confianza en vecinos; b) Cohesión barrial; c) Sociabilidad barrial y d) Satisfacción residencial.
Además, se excluyen los indicadores "Seguridad en el vecindario" y "Limpieza y belleza del barrio" de la subdimensión Satisfacción residencial y el indicador "La gente del barrio es cordial" de la subdimensión Sociabilidad barrial

```{r include=FALSE}
# crear una base de datos con menos variables para estimar los AFC
vecindario = data %>%
  dplyr::select(t01_w01, t02_01_w01, t02_02_w01, t02_03_w01, t02_04_w01, t03_01_w01, t03_02_w01, t03_03_w01, t03_04_w01, t06_01_w01, t06_02_w01, t06_03_w01, t06_04_w01, t06_05_w01, t06_06_w01, t06_07_w01, t06_08_w01) %>%
  as.data.frame() %>%
  na.omit()
```
```{r include=FALSE}
# Queda fuera t03_03_w01 (La gente del barrio es cordial) por "mi" alto al estimarse con t03_01_w01 (En barrio es facil hacer amigos) (mi=91.609)
cfa_4c <- '
confianza =~ t01_w01
cohesion =~ t02_01_w01 + t02_02_w01 + t02_03_w01 + t02_04_w01
sociabilidad =~ t03_01_w01 + t03_02_w01 + t03_04_w01
satisfaccion =~ t06_02_w01 + t06_03_w01 + t06_05_w01 + t06_06_w01 + t06_07_w01 + t06_08_w01
'
fit_4c <- cfa(cfa_4c,data=vecindario,missing="ML",estimator="MLR")
show(fit_4c) # Resumen ajuste general
summary(fit_4c, fit.measures=T, standardized=T)
```

```{r echo=FALSE}
fitMeasures(fit_4c, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
# Buen ajuste
```
```{r echo=FALSE}
semPaths(fit_4c, intercepts = FALSE,edge.label.cex=1.5, optimizeLatRes = TRUE, groups = "lat",pastel = TRUE, exoVar = FALSE, sizeInt=5,edge.color ="black",esize = 6, label.prop=2,sizeLat = 6,"std", layout="circle2")
```

# Anexos

## Tablas descriptivas por subdimensión
### Lazos

```{r echo=FALSE}
view(dfSummary(select(data, r15_w02),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table1.html")
webshot(url ="../output/tables/table1.html" ,file ="../output/tables/table1.png")
```

### Confianza interpersonal
```{r echo=FALSE}
view(dfSummary(select(data, c02_w01, c03_w01, c04_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table2.html")
webshot(url ="../output/tables/table2.html" ,file ="../output/tables/table2.png")
```

### Reconocimiento y respeto de la diversidad
```{r echo=FALSE}
view(dfSummary(select(data, r12_03_w01, r12_04_w01, c37_01_w03, c06_04_w01, c06_05_w01, c06_06_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table3.html")
webshot(url ="../output/tables/table3.html" ,file ="../output/tables/table3.png")
```

### Identificación con el país

```{r echo=FALSE}
view(dfSummary(select(data, c32_01_w01, c32_02_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table4.html")
webshot(url ="../output/tables/table4.html" ,file ="../output/tables/table4.png")
```

### Percepción de justicia
```{r echo=FALSE}
view(dfSummary(select(data, c18_09_w01, c18_10_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table5.html")
webshot(url ="../output/tables/table5.html" ,file ="../output/tables/table5.png")
```

### Confianza institucional
```{r echo=FALSE}
view(dfSummary(select(data, c05_01_w01, c05_02_w01, c05_03_w01, c05_04_w01, c05_05_w01, c05_06_w01, c05_07_w01, c05_08_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 1.0,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table6.html")
webshot(url ="../output/tables/table6.html" ,file ="../output/tables/table6.png")
```

### Solidaridad
```{r echo=FALSE}
view(dfSummary(select(data, c07_01_w01, c07_02_w01, c07_03_w01, c07_04_w01, c07_05_w01, c07_06_w01, c07_07_w01, c07_08_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table7.html")
webshot(url ="../output/tables/table7.html" ,file ="../output/tables/table7.png")
```

### Participación cívica
```{r echo=FALSE}
view(dfSummary(select(data, c08_01_w01, c08_02_w01, c08_03_w01, c08_04_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table8.html")
webshot(url ="../output/tables/table8.html" ,file ="../output/tables/table8.png")
```

### Participacion en organizaciones
```{r echo=FALSE}
view(dfSummary(select(data, c12_01_w01, c12_02_w01, c12_03_w01, c12_04_w01, c12_05_w01, c12_06_w01, c12_07_w01, c12_08_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table9.html")
webshot(url ="../output/tables/table9.html" ,file ="../output/tables/table9.png")
```

### Participacion electoral
```{r echo=FALSE}
view(dfSummary(select(data, c11_w01, c11_w03),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table10.html")
webshot(url ="../output/tables/table10.html" ,file ="../output/tables/table10.png")
```

### Confianza en vecinos
```{r echo=FALSE}
view(dfSummary(select(data, t01_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table11.html")
webshot(url ="../output/tables/table11.html" ,file ="../output/tables/table11.png")
```

### Cohesion barrial
```{r echo=FALSE}

view(dfSummary(select(data, t02_01_w01, t02_02_w01, t02_03_w01, t02_04_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table12.html")
webshot(url ="../output/tables/table12.html" ,file ="../output/tables/table12.png")
```

### Sociabilidad barrial
```{r echo=FALSE}
view(dfSummary(select(data, t03_01_w01, t03_02_w01, t03_03_w01, t03_04_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table13.html")
webshot(url ="../output/tables/table13.html" ,file ="../output/tables/table13.png")
```

### Satisfaccion residencial
```{r echo=FALSE}
view(dfSummary(select(data, t06_01_w01, t06_02_w01, t06_03_w01, t06_04_w01, t06_05_w01, t06_06_w01, t06_07_w01, t06_08_w01),
               plain.ascii = FALSE,
               style = "grid",
               #tmp.img.dir = "/tmp",
               graph.magnif = 0.9,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = T,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(5,5,10,10,10,10)
               ), file = "../output/tables/table14.html")
webshot(url ="../output/tables/table14.html" ,file ="../output/tables/table14.png")
```


<div style="text-align: justify">
