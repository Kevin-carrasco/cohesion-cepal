psych::fa.parallel(diversidad_fa, fa="fa")
psych::scree(diversidad_fa)
fac_ml <- psych::fa(r = diversidad_fa, nfactors = 3, fm= "ml", rotate = "varimax" )
# Análisis Factorial Exploratorio
diversidad_fa<-
data %>%
dplyr::select(amenaza_simbolica = r12_03_w01,
amenaza_material = r12_04_w01,
adopcion_homoparental = c37_01_w03,
confianza_homosexuales = c06_04_w01,
confianza_mapuche = c06_05_w01,
confianza_inmigrantes = c06_06_w01) %>% na.omit()
sjmisc::frq(data$r12_03_w01)
sjmisc::frq(data$r12_04_w01)
diversidad_fa <- diversidad_fa %>%
mutate(amenaza_simbolica_rev = 6 - amenaza_simbolica,
amenaza_material_rev = 6 - amenaza_material)
diversidad_fa <- diversidad_fa %>% select(-amenaza_simbolica,-amenaza_material)
colnames(diversidad_fa) <- c(label(diversidad_fa$adopcion_homoparental), label(diversidad_fa$confianza_homosexuales), label(diversidad_fa$confianza_mapuche), label(diversidad_fa$confianza_inmigrantes), label(data$r12_03_w01), label(data$r12_04_w01))
psych::fa.parallel(diversidad_fa, fa="fa")
psych::scree(diversidad_fa)
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools, psych)
# Análisis Factorial Exploratorio
diversidad_fa<-
data %>%
dplyr::select(amenaza_simbolica = r12_03_w01,
amenaza_material = r12_04_w01,
adopcion_homoparental = c37_01_w03,
confianza_homosexuales = c06_04_w01,
confianza_mapuche = c06_05_w01,
confianza_inmigrantes = c06_06_w01)
diversidad_fa <- diversidad_fa %>%
mutate(amenaza_simbolica_rev = 6 - amenaza_simbolica,
amenaza_material_rev = 6 - amenaza_material)
diversidad_fa <- diversidad_fa %>% select(-amenaza_simbolica,-amenaza_material)
colnames(diversidad_fa) <- c(label(diversidad_fa$adopcion_homoparental), label(diversidad_fa$confianza_homosexuales), label(diversidad_fa$confianza_mapuche), label(diversidad_fa$confianza_inmigrantes), label(data$r12_03_w01), label(data$r12_04_w01))
psych::fa.parallel(diversidad_fa, fa="fa")
View(diversidad_fa)
# Análisis Factorial Exploratorio
diversidad_fa<-
data %>%
dplyr::select(amenaza_simbolica = r12_03_w01,
amenaza_material = r12_04_w01,
adopcion_homoparental = c37_01_w03,
confianza_homosexuales = c06_04_w01,
confianza_mapuche = c06_05_w01,
confianza_inmigrantes = c06_06_w01)
diversidad_fa <- diversidad_fa %>%
mutate(amenaza_simbolica_rev = 6 - amenaza_simbolica,
amenaza_material_rev = 6 - amenaza_material)
install.packages("extrafont")
library(extrafont)
font_import()
loadfonts(device="win")       #Register fonts for Windows bitmap output
fonts()                       #vector of font family names
library(ggplot2)
data(mtcars)
force(mtcars)
data(mtcars)
ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point() +
ggtitle("Fuel Efficiency of 32 Cars") +
xlab("Weight (x1000 lb)") + ylab("Miles per Gallon") +
theme_bw() +
theme(text=element_text(family="Arial", face="bold", size=12)) #Times New Roman, 12pt, Bold
ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point() +
ggtitle("Fuel Efficiency of 32 Cars") +
xlab("Weight (x1000 lb)") + ylab("Miles per Gallon") +
theme_bw() +
theme(text=element_text(family="Arial", size=12)) #Times New Roman, 12pt, Bold
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools, psych)
# Cargar base elsoc longitudinal (2016-2019) creada en "preparacion"
load("input/data/data.RData")
lazos <-  plot_stackfrq(select(data, r15_w02, r13_nredes_w02, vol.red_w01), geom.size = 0.33) +
theme(text=element_text(family="Arial", size=12),
axis.text.y = element_text(colour = "black", size = 10),
axis.text.x = element_text(colour = "black", size = 10),
legend.text = element_text(size = 10),
legend.position="bottom")
lazos
lazos <-  plot_stackfrq(select(data, r15_w02, r13_nredes_w02, vol.red_w01), geom.size = 0.33) +
theme(text=element_text(family="Arial", size=12),
legend.position="bottom")
lazos
lazos <-  plot_stackfrq(select(data, r15_w02, r13_nredes_w02, vol.red_w01), geom.size = 0.33) +
theme(text=element_text(family="Arial", face="bold", size=12),
legend.position="bottom")
lazos
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black",
theme(text=element_text(family="Arial", face="bold", size=12),
legend.position="bottom"))
lazos_cor<-
data %>%
dplyr::select(r15_w02, r13_nredes_w02, vol.red_w01) %>%
lavaan::lavCor(., ordered=names(.))
diag(lazos_cor) = NA
rownames(lazos_cor) <- c("A. Cantidad de amigos/as cercanos",
"B. Tamaño de red cercana",
"C. Variedad de la red")
colnames(lazos_cor) <-c("(A)", "(B)","(C)")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black",
theme(text=element_text(family="Arial", face="bold", size=12),
legend.position="bottom"))
conf_interpersonal <- plot_stackfrq(select(data, c02_rec_w01, c03_rec_w01, c04_rec_w01), geom.colors = "RdBu", geom.size = 0.33) +
theme(text=element_text(family="Arial", face="bold", size=12),
legend.position="bottom")
conf_interpersonal
prejuicios<- plot_stackfrq(select(data, r12_03_w01, r12_04_w01, c37_01_w03), geom.colors = "RdBu", geom.size = 0.33) +
theme(axis.text.y = element_text(colour = "black", size = 10),
axis.text.x = element_text(colour = "black", size = 10),
legend.text = element_text(size = 10),
legend.position="bottom")
prejuicios
prejuicios<- plot_stackfrq(select(data, r12_03_w01, r12_04_w01, c37_01_w03), geom.colors = "RdBu", geom.size = 0.33) +
theme(text=element_text(family="Arial", face="bold", size=12),
legend.position="bottom")
prejuicios
ggsave(lazos, file = "bookdown-files/output/graphs/lazos.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
lazos <-  plot_stackfrq(select(data, r15_w02, r13_nredes_w02, vol.red_w01), geom.size = 0.33) +
theme(text=element_text(family="Arial", size=12),
legend.position="bottom")
ggsave(lazos, file = "bookdown-files/output/graphs/lazos.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
windowsFonts()
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
svg("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
dev.off()
svg("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools, psych, svglite)
lazos_cor<-
data %>%
dplyr::select(r15_w02, r13_nredes_w02, vol.red_w01) %>%
lavaan::lavCor(., ordered=names(.))
diag(lazos_cor) = NA
rownames(lazos_cor) <- c("A. Cantidad de amigos/as cercanos",
"B. Tamaño de red cercana",
"C. Variedad de la red")
colnames(lazos_cor) <-c("(A)", "(B)","(C)")
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
lazos_cor<-
data %>%
dplyr::select(r15_w02, r13_nredes_w02, vol.red_w01) %>%
lavaan::lavCor(., ordered=names(.))
diag(lazos_cor) = NA
rownames(lazos_cor) <- c("A. Cantidad de amigos/as cercanos",
"B. Tamaño de red cercana",
"C. Variedad de la red")
colnames(lazos_cor) <-c("(A)", "(B)","(C)")
par(family="Arial")
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
plot <- corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
ggsave(plot, file = "bookdown-files/output/graphs/plot.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
ggsave(plot, file = "bookdown-files/output/graphs/plot.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
lazos_cor<-
data %>%
dplyr::select(r15_w02, r13_nredes_w02, vol.red_w01) %>%
lavaan::lavCor(., ordered=names(.))
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300)
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
lazos_cor<-
data %>%
dplyr::select(r15_w02, r13_nredes_w02, vol.red_w01) %>%
lavaan::lavCor(., ordered=names(.))
diag(lazos_cor) = NA
rownames(lazos_cor) <- c("A. Cantidad de amigos/as cercanos",
"B. Tamaño de red cercana",
"C. Variedad de la red")
colnames(lazos_cor) <-c("(A)", "(B)","(C)")
par(family="Arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
view(corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black"))
help(svg)
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300, family = "Arial")
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300, family = "arial")
svglite("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300, family = "mono")
svg("bookdown-files/output/graphs/lazos_cor.svg",width=600,height=300, family = "arial")
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.off()
corrplot::corrplot(lazos_cor,
method = "color",
addCoef.col = "#000390",
type = "upper",
tl.col = "black",
col=colorRampPalette(c("white","#0068DC"))(12),
bg = "white",
na.label = "-",
lower.col = "black")
dev.print(svg,           # Tipo de archivo para la exportación (svg, jpeg, ...)
"bookdown-files/output/graphs/lazos_cor.svg")
?par
par(family="Arial", size= 10)
table(data$m18)
data %>% select(m18) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools, lavaan, texreg, lme4)
data %>% select(m18) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data %>% select(m18_w01) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data %>% select(m18_w03) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data %>% select(m18) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data %>% select(m08) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data %>% select(m18_w01) %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
knitr::opts_chunk$set(echo = T, warning = F, message = F)
data$m18_w01 <- car::recode(data$m18_w01, "c(1,2,3)=1 ; 4=2")
data$m18_w01 <- factor(data$m18_w01, levels = c("1", "2"), labels=c("Si cotiza", "No esta cotizando"))
frq(data$m18_w01)
# Cargar paquetes
pacman::p_load(dplyr, car, summarytools, webshot, knitr, kableExtra, corrplot, ggplot2, sjPlot, sjmisc, semPlot, semTools, lavaan, texreg, lme4)
data$lazos_w01 = data$vol.red_w01
data$lazos_w03 = data$vol.red_w03
data %>% select(lazos_w01, lazos_w03)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
frq(hacin_ciu)
frq(data$hacin_ciu)
frq(data$hacin_ciu)
frq(data$hacin_mnz)
hacin_mnz
data$hacin_mnz
cit <- read_excel("input/data/ELSOC_CIT_Dataset_2016.xlsx")
pacman::p_load(dplyr, car, summarytools, webshot, sjmisc, readxl)
cit <- read_excel("input/data/ELSOC_CIT_Dataset_2016.xlsx")
table(cit$hacin_mnz)
cit <- cit %>% car::recode(., "c(994,995,996)=NA") # recode missings de no respuesta a NA
table(cit$hacin_mnz)
# Juntar base con datos CIT
data <- inner_join(data, cit, by="idencuesta", copy = FALSE, suffix = c("", "_cit"))
data$hacin_mnz
table(data$hacin_mnz)
# Cargar base de datos
load("input/data/data.RData")
table(data$hacin_mnz)
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
data$lazos_w01 = data$vol.red_w01
data$lazos_w03 = data$vol.red_w03
data %>% select(lazos_w01, lazos_w03, vol.red_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$lazos_w01 = data$vol.red_w01
data$lazos_w03 = data$vol.red_w03
data$lazos_w05 = data$vol.red_w05
data %>% select(lazos_w01, lazos_w03, lazos_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$lazos_w01 <- ifelse((data$lazos_w01<1.5), 1,
ifelse((data$lazos_w01<2.5), 2,
ifelse((data$lazos_w01<3.5), 3,
ifelse((data$lazos_w01<4.5), 4,
ifelse((data$lazos_w01<=5), 5, NA)))))
data$lazos_w03 <- ifelse((data$lazos_w03<1.5), 1,
ifelse((data$lazos_w03<2.5), 2,
ifelse((data$lazos_w03<3.5), 3,
ifelse((data$lazos_w03<4.5), 4,
ifelse((data$lazos_w03<=5), 5, NA)))))
data$lazos_w01<- factor(data$lazos_w01, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data$lazos_w03<- factor(data$lazos_w03, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data %>% select(lazos_w01, lazos_w03)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$lazos_w01 = data$vol.red_w01
data$lazos_w03 = data$vol.red_w03
data$lazos_w05 = data$vol.red_w05
data %>% select(lazos_w01, lazos_w03, lazos_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$lazos_w01<- factor(data$lazos_w01, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data$lazos_w03<- factor(data$lazos_w03, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data$lazos_w05<- factor(data$lazos_w05, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data %>% select(lazos_w01, lazos_w03, lazos_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$ponderador02_w05 <- data$ponderador02
elsoc_long <- long_panel(data = data, #base de datos formato wide
prefix = "_w0", #caracteres antes de la etiqueta de cada ola
begin = 1, #etiqueta de la primera ola
end = 5, #etiqueta de la última ola
label_location = "end", #indica donde se localiza la etiqueta asociada a la ola
id = "idencuesta", #indica identificador individual
wave = "ola") #nombre que tomará la variable que indica periodo.
# Cargar paquetes
pacman::p_load(dplyr, panelr, survey, ggplot2, summarytools)
elsoc_long <- long_panel(data = data, #base de datos formato wide
prefix = "_w0", #caracteres antes de la etiqueta de cada ola
begin = 1, #etiqueta de la primera ola
end = 5, #etiqueta de la última ola
label_location = "end", #indica donde se localiza la etiqueta asociada a la ola
id = "idencuesta", #indica identificador individual
wave = "ola") #nombre que tomará la variable que indica periodo.
#Recode variable "ola" correspondiente a la ola de medición.
elsoc_long$ola <- factor(elsoc_long$ola,labels = c('2016', '2017', '2018', '2019', '2020'))
elsoc_long$ola <- sjlabelled::set_label(elsoc_long$ola, label = c("Ola de Medición"))
elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
weights = ~ponderador02, #ponderador de corte transversal
nest = TRUE,
data = elsoc_long)
#Paso 1
datos.lazos <- data.frame((svytable(~lazos + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.lazos <- data.frame((svytable(~lazos + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_lazos <- ggplot(datos.lazos, aes(x = ola, fill = lazos, stratum = lazos,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.lazos,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_lazos
knitr::opts_chunk$set(echo = TRUE, warning=F, message=F)
ggsave(alluvial_lazos, file = "bookdown-files/output/graphs/alluvial_lazos.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
# Cargar paquetes
pacman::p_load(dplyr, panelr, survey, ggplot2, summarytools)
ggsave(alluvial_lazos, file = "bookdown-files/output/graphs/alluvial_lazos.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
alluvial_lazos <- ggplot(datos.lazos, aes(x = ola, fill = lazos, stratum = lazos,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.lazos,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_lazos
data$lazos_w01 = as.numeric(data$vol.red_w01)
data$lazos_w03 = as.numeric(data$vol.red_w03)
data$lazos_w05 = as.numeric(data$vol.red_w05)
data %>% select(lazos_w01, lazos_w03, lazos_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$lazos_w01<- factor(data$lazos_w01, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data$lazos_w03<- factor(data$lazos_w03, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data$lazos_w05<- factor(data$lazos_w05, levels = c(1, 2, 3, 4, 5), labels = c("No tiene", "De 1 a 2", "De 3 a 5", "De 6 a 10", "Mas de 10"))
data %>% select(lazos_w01, lazos_w03, lazos_w05)  %>% sjlabelled::as_label(.)  %>%  dfSummary(, graph.col = FALSE)
data$ponderador02_w05 <- data$ponderador02
elsoc_long <- long_panel(data = data, #base de datos formato wide
prefix = "_w0", #caracteres antes de la etiqueta de cada ola
begin = 1, #etiqueta de la primera ola
end = 5, #etiqueta de la última ola
label_location = "end", #indica donde se localiza la etiqueta asociada a la ola
id = "idencuesta", #indica identificador individual
wave = "ola") #nombre que tomará la variable que indica periodo.
#Recode variable "ola" correspondiente a la ola de medición.
elsoc_long$ola <- factor(elsoc_long$ola,labels = c('2016', '2017', '2018', '2019', '2020'))
elsoc_long$ola <- sjlabelled::set_label(elsoc_long$ola, label = c("Ola de Medición"))
elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
weights = ~ponderador02, #ponderador de corte transversal
nest = TRUE,
data = elsoc_long)
#Paso 1
datos.lazos <- data.frame((svytable(~lazos + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.lazos <- data.frame((svytable(~lazos + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_lazos <- ggplot(datos.lazos, aes(x = ola, fill = lazos, stratum = lazos,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.lazos,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_lazos
ggsave(alluvial_lazos, file = "bookdown-files/output/graphs/alluvial_lazos.svg",device = "svg",width = 25,height = 13,dpi = "retina",units = "cm")
