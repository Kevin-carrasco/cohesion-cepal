aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
ggplot(datos.lazos, aes(x = ola, fill = vol.red, stratum = vol.red,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.d.1,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
#Paso 1
datos.lazos <- data.frame((svytable(~vol.red + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.lazos <- data.frame((svytable(~vol.red + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
ggplot(datos.lazos, aes(x = ola, fill = vol.red, stratum = vol.red,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.d.1,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
#Paso 1
datos.lazos <- data.frame((svytable(~vol.red + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.lazos <- data.frame((svytable(~vol.red + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
ggplot(datos.lazos, aes(x = ola, fill = vol.red, stratum = vol.red,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.d.1,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
View(datos.lazos)
ggplot(datos.lazos, aes(x = ola, fill = vol.red, stratum = vol.red,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.lazos,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
#Paso 1
datos.conf.interpersonal <- data.frame((svytable(~conf_interpersonal + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.conf.interpersonal <- data.frame((svytable(~conf_interpersonal + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_conf.interpersonal <- ggplot(datos.conf.interpersonal,
aes(x = ola, fill = conf_interpersonal,
stratum = conf_interpersonal,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.conf.interpersonal,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_conf.interpersonal
#Paso 1
datos.diversidad <- data.frame((svytable(~diversidad + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.diversidad <- data.frame((svytable(~diversidad + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_diversidad <- ggplot(datos.diversidad, aes(x = ola, fill = diversidad, stratum = diversidad,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.diversidad,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_diversidad
#Paso 1
datos.identificacion <- data.frame((svytable(~identificacion + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.identificacion <- data.frame((svytable(~identificacion + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_identificacion <- ggplot(datos.identificacion, aes(x = ola, fill = identificacion, stratum = identificacion,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.identificacion,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_identificacion
#Paso 1
datos.justicia <- data.frame((svytable(~justicia + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.justicia <- data.frame((svytable(~justicia + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_justicia <- ggplot(datos.justicia, aes(x = ola, fill = justicia, stratum = justicia,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.justicia,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_justicia
#Paso 1
datos.conf.institucional <- data.frame((svytable(~conf_institucional + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.conf.institucional <- data.frame((svytable(~conf_institucional + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_conf.institucional <- ggplot(datos.conf.institucional, aes(x = ola, fill = conf_institucional, stratum = conf_institucional,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.conf.institucional,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_conf.institucional
#Paso 1
datos.solidaridad <- data.frame((svytable(~solidaridad + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.solidaridad <- data.frame((svytable(~solidaridad + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_solidaridad <- ggplot(datos.solidaridad, aes(x = ola, fill = solidaridad, stratum = solidaridad,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.solidaridad,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_solidaridad
#Paso 1
datos.participacion <- data.frame((svytable(~participacion + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.participacion <- data.frame((svytable(~participacion + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_participacion <- ggplot(datos.participacion, aes(x = ola, fill = participacion, stratum = participacion,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.participacion,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_participacion
#Paso 1
datos.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_cohesion_territorial <- ggplot(datos.cohesion_territorial, aes(x = ola, fill = cohesion_territorial, stratum = cohesion_territorial,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.cohesion_territorial,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_cohesion_territorial
#Paso 1
datos.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_cohesion_territorial <- ggplot(datos.cohesion_territorial, aes(x = ola, fill = cohesion_territorial, stratum = cohesion_territorial,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.cohesion_territorial,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_cohesion_territorial
data$cohesion_territorial_w01 <- ifelse((data$cohesion_territorial_w01<1.5), 1,
ifelse((data$cohesion_territorial_w01<2.5), 2,
ifelse((data$cohesion_territorial_w01<3.5), 3,
ifelse((data$cohesion_territorial_w01<4.5), 4,
ifelse((data$cohesion_territorial_w01<=5), 5, NA)))))
data$cohesion_territorial_w02 <- ifelse((data$cohesion_territorial_w02<1.5), 1,
ifelse((data$cohesion_territorial_w02<2.5), 2,
ifelse((data$cohesion_territorial_w02<3.5), 3,
ifelse((data$cohesion_territorial_w02<4.5), 4,
ifelse((data$cohesion_territorial_w02<=5), 5, NA)))))
data$cohesion_territorial_w03 <- ifelse((data$cohesion_territorial_w03<1.5), 1,
ifelse((data$cohesion_territorial_w03<2.5), 2,
ifelse((data$cohesion_territorial_w03<3.5), 3,
ifelse((data$cohesion_territorial_w03<4.5), 4,
ifelse((data$cohesion_territorial_w03<=5), 5, NA)))))
data$cohesion_territorial_w04 <- ifelse((data$cohesion_territorial_w04<1.5), 1,
ifelse((data$cohesion_territorial_w04<2.5), 2,
ifelse((data$cohesion_territorial_w04<3.5), 3,
ifelse((data$cohesion_territorial_w04<4.5), 4,
ifelse((data$cohesion_territorial_w04<=5), 5, NA)))))
data$cohesion_territorial_w01<- factor(data$cohesion_territorial_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w02<- factor(data$cohesion_territorial_w02, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w03<- factor(data$cohesion_territorial_w03, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w04<- factor(data$cohesion_territorial_w04, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
#Paso 1
datos.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_cohesion_territorial <- ggplot(datos.cohesion_territorial, aes(x = ola, fill = cohesion_territorial, stratum = cohesion_territorial,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.cohesion_territorial,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_cohesion_territorial
data$cohesion_territorial_w01 <- ifelse((data$cohesion_territorial_w01<1.5), 1,
ifelse((data$cohesion_territorial_w01<2.5), 2,
ifelse((data$cohesion_territorial_w01<3.5), 3,
ifelse((data$cohesion_territorial_w01<4.5), 4,
ifelse((data$cohesion_territorial_w01<=5), 5, NA)))))
data$cohesion_territorial_w02 <- ifelse((data$cohesion_territorial_w02<1.5), 1,
ifelse((data$cohesion_territorial_w02<2.5), 2,
ifelse((data$cohesion_territorial_w02<3.5), 3,
ifelse((data$cohesion_territorial_w02<4.5), 4,
ifelse((data$cohesion_territorial_w02<=5), 5, NA)))))
data$cohesion_territorial_w03 <- ifelse((data$cohesion_territorial_w03<1.5), 1,
ifelse((data$cohesion_territorial_w03<2.5), 2,
ifelse((data$cohesion_territorial_w03<3.5), 3,
ifelse((data$cohesion_territorial_w03<4.5), 4,
ifelse((data$cohesion_territorial_w03<=5), 5, NA)))))
data$cohesion_territorial_w04 <- ifelse((data$cohesion_territorial_w04<1.5), 1,
ifelse((data$cohesion_territorial_w04<2.5), 2,
ifelse((data$cohesion_territorial_w04<3.5), 3,
ifelse((data$cohesion_territorial_w04<4.5), 4,
ifelse((data$cohesion_territorial_w04<=5), 5, NA)))))
data$cohesion_territorial_w01<- factor(data$cohesion_territorial_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w02<- factor(data$cohesion_territorial_w02, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w03<- factor(data$cohesion_territorial_w03, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w04<- factor(data$cohesion_territorial_w04, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
elsoc_long <- long_panel(data = data, #base de datos formato wide
prefix = "_w0", #caracteres antes de la etiqueta de cada ola
begin = 1, #etiqueta de la primera ola
end = 5, #etiqueta de la última ola
label_location = "end", #indica donde se localiza la etiqueta asociada a la ola
id = "idencuesta", #indica identificador individual
wave = "ola") #nombre que tomará la variable que indica periodo.
knitr::opts_chunk$set(echo = T, warning = F, message = F)
label(data$t02_01_w01) <- "Este barrio es ideal para mi (2016)."
label(data$t02_01_w02) <- "Este barrio es ideal para mi (2017)."
label(data$t02_01_w03) <- "Este barrio es ideal para mi (2018)."
label(data$t02_01_w04) <- "Este barrio es ideal para mi (2019)."
label(data$t02_02_w01) <- "Me siento integrado/a en este barrio (2016)."
label(data$t02_02_w02) <- "Me siento integrado/a en este barrio (2017)."
label(data$t02_02_w03) <- "Me siento integrado/a en este barrio (2018)."
label(data$t02_02_w04) <- "Me siento integrado/a en este barrio (2019)."
label(data$t02_03_w01) <- "Me identifico con la gente de este barrio (2016)."
label(data$t02_03_w02) <- "Me identifico con la gente de este barrio (2017)."
label(data$t02_03_w03) <- "Me identifico con la gente de este barrio (2018)."
label(data$t02_03_w04) <- "Me identifico con la gente de este barrio (2019)."
label(data$t02_04_w01) <- "Este barrio es parte de mi (2016)."
label(data$t02_04_w02) <- "Este barrio es parte de mi (2017)."
label(data$t02_04_w03) <- "Este barrio es parte de mi (2018)."
label(data$t02_04_w04) <- "Este barrio es parte de mi (2019)."
data <- data %>%
rowwise() %>%
mutate(cohesion_territorial_w01 =
mean(c(t02_01_w01, t02_02_w01, t02_03_w01, t02_04_w01), na.rm = T))
data <- data %>%
rowwise() %>%
mutate(cohesion_territorial_w02 =
mean(c(t02_01_w02, t02_02_w02, t02_03_w02, t02_04_w02), na.rm = T))
data <- data %>%
rowwise() %>%
mutate(cohesion_territorial_w03 =
mean(c(t02_01_w03, t02_02_w03, t02_03_w03, t02_04_w03), na.rm = T))
data <- data %>%
rowwise() %>%
mutate(cohesion_territorial_w04 =
mean(c(t02_01_w04, t02_02_w04, t02_03_w04, t02_04_w04), na.rm = T))
data$cohesion_territorial_w01 <- ifelse((data$cohesion_territorial_w01<1.5), 1,
ifelse((data$cohesion_territorial_w01<2.5), 2,
ifelse((data$cohesion_territorial_w01<3.5), 3,
ifelse((data$cohesion_territorial_w01<4.5), 4,
ifelse((data$cohesion_territorial_w01<=5), 5, NA)))))
data$cohesion_territorial_w02 <- ifelse((data$cohesion_territorial_w02<1.5), 1,
ifelse((data$cohesion_territorial_w02<2.5), 2,
ifelse((data$cohesion_territorial_w02<3.5), 3,
ifelse((data$cohesion_territorial_w02<4.5), 4,
ifelse((data$cohesion_territorial_w02<=5), 5, NA)))))
data$cohesion_territorial_w03 <- ifelse((data$cohesion_territorial_w03<1.5), 1,
ifelse((data$cohesion_territorial_w03<2.5), 2,
ifelse((data$cohesion_territorial_w03<3.5), 3,
ifelse((data$cohesion_territorial_w03<4.5), 4,
ifelse((data$cohesion_territorial_w03<=5), 5, NA)))))
data$cohesion_territorial_w04 <- ifelse((data$cohesion_territorial_w04<1.5), 1,
ifelse((data$cohesion_territorial_w04<2.5), 2,
ifelse((data$cohesion_territorial_w04<3.5), 3,
ifelse((data$cohesion_territorial_w04<4.5), 4,
ifelse((data$cohesion_territorial_w04<=5), 5, NA)))))
data$cohesion_territorial_w01<- factor(data$cohesion_territorial_w01, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w02<- factor(data$cohesion_territorial_w02, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w03<- factor(data$cohesion_territorial_w03, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
data$cohesion_territorial_w04<- factor(data$cohesion_territorial_w04, levels = c(1, 2, 3, 4, 5), labels = c("Totalmente en desacuerdo", "En desacuerdo", "Ni de acuerdo ni en desacuerdo", "De acuerdo", "Totalmente de acuerdo"))
elsoc_long <- long_panel(data = data, #base de datos formato wide
prefix = "_w0", #caracteres antes de la etiqueta de cada ola
begin = 1, #etiqueta de la primera ola
end = 5, #etiqueta de la última ola
label_location = "end", #indica donde se localiza la etiqueta asociada a la ola
id = "idencuesta", #indica identificador individual
wave = "ola") #nombre que tomará la variable que indica periodo.
#Recode variable "ola" correspondiente a la ola de medición.
elsoc_long$ola <- factor(elsoc_long$ola,labels = c('2016', '2017', '2018', '2019', '2020'))
elsoc_long$ola <- sjlabelled::set_label(elsoc_long$ola, label = c("Ola de Medición"))
elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)
strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)
nest = TRUE,
data = elsoc_long)
#Paso 1
datos.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola + idencuesta, elsoc_diseno, round = F))) %>% dplyr::filter(Freq>0)  %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()
#Paso 2
etiquetas.cohesion_territorial <- data.frame((svytable(~cohesion_territorial + ola, elsoc_diseno, round = F))) %>% group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>%
mutate(idencuesta = 1)
alluvial_cohesion_territorial <- ggplot(datos.cohesion_territorial, aes(x = ola, fill = cohesion_territorial, stratum = cohesion_territorial,
alluvium = idencuesta, y = porcentaje))+
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(begin = 0, end = .95, direction = -1, option = 'viridis') +
geom_text(data = etiquetas.cohesion_territorial,
aes(label = ifelse(porcentaje > 0.03 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 2,
color = rep('white'))+
ggtitle('Cambio de frecuencias según año')
alluvial_cohesion_territorial
ene <- read_sav(url("https://www.ine.cl/docs/default-source/ocupacion-y-desocupacion/bbdd/2021/spss/ene-2021-01-def.sav?sfvrsn=aa1ac2fa_4&download=true"))
pacman::p_load(haven, dplyr, casen)
ene <- read_sav(url("https://www.ine.cl/docs/default-source/ocupacion-y-desocupacion/bbdd/2021/spss/ene-2021-01-def.sav?sfvrsn=aa1ac2fa_4&download=true"))
ocu <- mutate(ene, ocu = if_else(cae_especifico=1:7, 1, 0))
ocu <- mutate(ene, ocu = if_else(cae_especifico==1:7, 1, 0))
ene <- mutate(ene, pet = if_else(edad>=15,1,0))
ene$pet
ocu <- mutate(ene, ocu = if_else(cae_especifico==1:7, 1, 0))
ocu <- mutate(ene, ocu = if_else(cae_especifico==c("1:7"), 1, 0))
ocu <- mutate(ene, ocu = if_else(cae_especifico>=1, 1, ))
ocu <- mutate(ene, ocu = if_else(cae_especifico>=1, 1, if_else(cae_especifico<=7), 1, 0))
ene <- mutate(ene, ocu = if_else(cae_especifico==1:7, 1, 0))
ene <- mutate(ene, ocu = if_else(cae_especifico>=1, 1, if_else(cae_especifico<=7), 1, 0))
ene <- mutate(ene, ocu = if_else(cae_especifico>=1, 1, if_else(cae_especifico<=7, 1, 0)))
ene$ocu
table(ene$ocu)
ene <- read_sav(url("https://www.ine.cl/docs/default-source/ocupacion-y-desocupacion/bbdd/2021/spss/ene-2021-01-def.sav?sfvrsn=aa1ac2fa_4&download=true"))
ene <- mutate(ene, ocu = if_else(cae_especifico==1:7, 1, 0))
table(ene$cae_especifico)
ene <- mutate(ene, ocu = if_else(cae_especifico>=1|cae_especifico<=7, 1, 0))
table(ene$ocu)
ene <- read_sav(url("https://www.ine.cl/docs/default-source/ocupacion-y-desocupacion/bbdd/2021/spss/ene-2021-01-def.sav?sfvrsn=aa1ac2fa_4&download=true"))
ene2<-ene
ene2 <- mutate(ene, ocu = if_else(cae_especifico>0, 1,
if_else(cae_especifico<8, 1, 0)))
ene2$ocu
table(ene2$ocu)
ene2<-ene
ene2 <- mutate(ene, ocu = if_else(cae_especifico==1:7, 1, 0))
ene2 <- mutate(ene, ocu = if_else(cae_especifico=1:7, 1, 0))
ene2 <- mutate(ene, ocu = if_else(cae_especifico<1, 0,
if_else(cae_especifico<8, 1, 0)))
table(ene2$ocu)
table(ene2$cae_especifico)
ene2<-ene
ene2 <- mutate(ene, ocu = if_else(cae_especifico==0, 0,
if_else(cae_especifico<=7, 1, 0)))
table(ene2$ocu)
ene2<-ene
ene2 <- mutate(ene, ocu = if_else(cae_especifico==c("1,2,3,4,5,6,7"), 1, 0))
ene2 <- mutate(ene, ocu = if_else(cae_especifico!=0&cae_especifico<=7, 1, 0))
table(ene$ocu)
table(ene2$ocu)
ene2<-ene
ene2 <- mutate(ene, ocu = if_else(cae_especifico>=1 & cae_especifico<=7, 1, 0))
table(ene2$ocu)
